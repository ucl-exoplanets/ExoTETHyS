= ExoTETHyS.BOATS User Manual
:author: Giuseppe Morello
:sectnums:
:sectnumlevels: 2
:toc: preamble
:toclevels: 4
:source-language: python
:experimental:
:xrefstyle: short

[big]#*Bias in the Occultation Analysis of Transiting Systems*#

image::https://github.com/ucl-exoplanets/ExoTETHyS/blob/master/logo.png[width=10%]
*version: 2.x.x - beta*

ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

[preamble]
== Introduction
The BOATS subpackage is designed to evaluate the impact of common approximations in modeling transit and eclipse light curves, such as neglecting the planet's flux or its variation with phase. Additionally, it can also be used:

- to calculate the absolute photometric fluxes and spectra of individual objects, exoplanetary systems and binaries;
- as a versatile S/N ratio calculator for observations with a long list of predefined instruments as well as user-supplied ones;
- to compute the transit duration, equilibrium temperature and other exoplanet atmospheric parameters.

The main functions rely on a minimal set of parameters that describe the orbital geometry and orientation, sizes and temperatures of the two bodies to compute the biases in transit/eclipse depth. Good estimates can de obtained by assuming blackbody emission spectra from star, exoplanet dayside and nightside. Pre-calculated grids of stellar spectra are also available. Users can provide their own spectra for each of the 3 components.

I refer to the https://arxiv.org/pdf/[photometry article] and https://arxiv.org/pdf/[spectroscopy article] for an introduction to the scientific motivations, mathematics and a detailed description of the core algorithms.

== User instructions

To compute the transit/eclipse depth biases you just need to import this subpackage and run the boats_calculate_transit/boats_calculate_eclipse function with a configuration file:
[source, bash]
```
>>> from exotethys import boats  
>>> boats.boats_calculate_transit('PATH_TO_ROOT/examples/boats_example1.txt')   
>>> boats.boats_calculate_eclipse('PATH_TO_ROOT/examples/boats_example5.txt')  
```
NOTE: The same configuration file could be used for either transit or eclipse calculation. +
If running both cases with the same configuration file, the output files are overwritten. +
To avoid this issue, you can use two configuration files differing only for the names and/or location of the output files.

In the following subsection I describe the configuration file and explain the various options available. Then I discuss the examples of configuration files that are available in the GitHub repository and show how to read the file products.

TIP: Although the BOATS subpackage has been conceived with a specific purpose in mind, most functions can be used independently and/or in different combinations to perform various tasks.

In the last subsection, I discuss other possible usage of the BOATS functions.

=== BOATS configuration file
The BOATS configuration file is a text file in which each line begins with a keyword followed by one or more values associated with the keyword. The lines starting with # are ignored; keyword values preceded by ! are also ignored. Examples of configuration files can be found in the "examples" folder.

Below I describe the available keywords:

*stellar_models_grid* (MANDATORY) +
values: _Phoenix_2018_, _Phoenix_2012_13_, _Atlas_2000_, _Stagger_2015_, _Blackbody_ or _Userfile_ +
only one choice per run (i.e., configuration file) is allowed

*planet_models_grid* (MANDATORY) +
values: _Blackbody_ or _Userfile_ +
only one choice per run (i.e., configuration file) is allowed

*star_model_path* (only if _Userfile_ stellar_models_grid, optional) +
values: path to user star model file

*star_model_file* (only if _Userfile_ stellar_models_grid, mandatory) +
values: user star model file name +
only one star_model_file per run (i.e., configuration file) is allowed

*rescale_star_flux* (only if _Userfile_ stellar_models_grid, mandatory) +
values: _Yes_ or _No_ +
_Yes_ if the user stellar spectrum has to be rescaled by the dilution factor: (star radius / distance from the observer)^2 +
_No_ if the user stellar spectrum already accounts for the dilution factor

*planet_day_model_path* (only if _Userfile_ planet_models_grid, optional) +
values: path to user file for the planet dayside

*planet_day_model_file* (only if _Userfile_ planet_models_grid, mandatory) +
values: user planet dayside file name +
only one planet_day_model_file per run (i.e., configuration file) is allowed

*planet_night_model_path* (only if _Userfile_ planet_models_grid, optional) +
values: path to user file for the planet nightside

*planet_night_model_file* (only if _Userfile_ planet_models_grid, mandatory) +
values: user planet nightside file name +
only one planet_night_model_file per run (i.e., configuration file) is allowed

*rescale_planet_flux* (only if _Userfile_ planet_models_grid, mandatory) +
values: _Yes_ or _No_ +
_Yes_ if the user planet dayside and nightside spectra have to be rescaled by the dilution factor: (planet radius / distance from the observer)^2 +
_No_ if the user planet dayside and nightside spectra already account for the dilution factor

*passbands_path* (OPTIONAL) +
values: path to user passbands

*passbands* (MANDATORY) +
values: built-in passband names if not passbands_path (same of file names at PATH_TO_ROOT/exotethys/Passbands/, without the .pass extension) or user file names including extension

*wavelength_bins_path* (OPTIONAL) +
values: path to wavelength bins files

*wavelength_bins_files* (OPTIONAL) +
values: user file names or _no_bins_ (if given, one entry per passband) +
The user files must be text files with 2 columns reporting the lower and upper limits of the desired wavelength bins within the corresponding passband (each row defines a wavelength bin).

*telescope_area* (MANDATORY) +
values: float type (positive) +
only one value per run (i.e., configuration file) is allowed

*telescope_area_unit* (MANDATORY) +
values: string representation of astropy.unit area (e.g., 'm2'='m**2', 'cm2')

*observing_duration* (MANDATORY) +
values: float type (transit_duration T_14 < observing_duration < period_orbital - transit_duration T_14) +
multiple entries allowed

*observing_duration_unit* (MANDATORY) +
values: string representation of astropy.unit time (e.g., 'hour' = 'hr' = 'h', 'second' = 's') or T_14

*star_effective_temperature* (MANDATORY, except if _Userfile_ stellar_models_grid & not planet_circulation_efficiency) +
values: float type (range depending on the stellar_models_grid) +
only one value per run (i.e., configuration file) is allowed

*star_log_gravity* (OPTIONAL) +
values: float type (range depending on the stellar_models_grid, default is 4.5) +
only one value per run (i.e., configuration file) is allowed

*star_metallicity* (OPTIONAL) +
values: float type (range depending on the stellar_models_grid, default is 0.0) +
only one value per run (i.e., configuration file) is allowed

*star_radius* (MANDATORY) +
values: float type (positive) +
only one value per run (i.e., configuration file) is allowed

*star_radius_unit* (MANDATORY) +
values: string representation of astropy.unit length (e.g., 'solRad'='Rsun', 'km', 'm')

*orbital_semimajor_axis* (MANDATORY) +
values: float type (orbital_semimajor_axis > star_radius) +
only one value per run (i.e., configuration file) is allowed

*orbital_semimajor_axis_unit* (MANDATORY) +
values: string representation of astropy.unit length (e.g., 'au'='AU', 'km', 'm') or star_radius

*orbital_inclination* (MANDATORY) +
values: float type (0 deg < = orbital_inclination < = 90 deg) +
only one value per run (i.e., configuration file) is allowed

*orbital_inclination_unit* (MANDATORY) +
values: string representation of astropy.unit angle (e.g., 'deg', 'rad'='radian')

*orbital_period* (MANDATORY) +
values: float type (positive) +
only one value per run (i.e., configuration file) is allowed

*orbital_period_unit* (MANDATORY) +
values: string representation of astropy.unit time (e.g., 'd'='day') or T_14

*planet_bond_albedo* (OPTIONAL) +
values: float type (0 < = planet_bond_albedo < = 1, default is 0.0) +
multiple entries allowed

*planet_circulation_efficiency* (OPTIONAL, not if _Userfile_ planet_models_grid, not if planet_day_temperature and planet_night_temperature) +
values: float type (0 < = planet_circulation_efficiency < = 1, default is 0.0) +
multiple entries allowed

*planet_day_temperature* (OPTIONAL, not if _Userfile_ planet_models_grid, not if planet_circulation_efficiency) +
values: float type (positive) +
multiple entries allowed

*planet_night_temperature* (OPTIONAL, not if _Userfile_ planet_models_grid, not if planet_circulation_efficiency) +
values: float type (positive) +
multiple entries allowed

*planet_radius* (MANDATORY) +
values: float type (positive) +
only one value per run (i.e., configuration file) is allowed

*planet_radius_unit* (MANDATORY) +
values: string representation of astropy.unit length (e.g., 'jupiterRad'='Rjup', 'km', 'm') or star_radius

*system_distance* (MANDATORY) +
values: float type (system_distance >= 1 AU) +
only one value per run (i.e., configuration file) is allowed

*system_distance_unit* (MANDATORY) +
values: string representation of astropy.unit length (e.g., 'pc'='parsec')

*output_path* (OPTIONAL) +
values: path to where to store the results

*output_filename* (OPTIONAL) +
values: string type (without extension)

*output_fileext* (OPTIONAL) +
values: _.pickle_ (default) and/or _.txt_


=== Description of examples

*boats_example1*: This example is to compute the bias over a single instrument passband with wavelength bins, using _Phoenix_2012_13_ stellar_models_grid, _Blackbody_ planet_models_grid with given planet_day_temperature and planet_night_temperature. It creates two files named "WASP43b_NIRISS_SOSS_pho1213_bb_Td1600_Tn850_A0e23.pickle" and "WASP43b_NIRISS_SOSS_pho1213_bb_Td1600_Tn850_A0e23.txt".

*boats_example2*: This example is to compute the bias over two instrument passbands with wavelength bins, using _Blackbody_ stellar_models_grid, _Blackbody_ planet_models_grid with given planet_day_temperature and planet_night_temperature. It creates a file named "WASP43b_NIRISS_NIRSpec_bb_bb_Td1600_Tn850_A0e23.pickle".

*boats_example3*: This example is to compute the bias over a single instrument passband with wavelength bins, using _Blackbody_ stellar_models_grid, _Userfile_ planet_models_grid. It creates a file named "WASP43b_NIRISS_SOSS_bb_ace_Td1600_Tn850_A0e23.pickle".

*boats_example4*: This example is to compute the bias over a single instrument passband with wavelength bins, using _Userfile_ stellar_models_grid, _Userfile_ planet_models_grid. It creates a file named "WASP43b_MIRI_LRS_jy_ace_Td1600_Tn850_A0e23.pickle".

*boats_example5*: This example differs from boats_example4 only for the output_filename. It creates a file named "WASP43b_MIRI_LRS_jy_ace_Td1600_Tn850_A0e23_eclipse.pickle".

NOTE: In principle, all examples can be used for either transit or eclipse calculation, but I am assuming that the transit case is more interesting to study.

*boats_example6*: This example is to compute the bias over four instrument passbands without wavelength bins, using _Blackbody_ stellar_models_grid, _Blackbody_ planet_models_grid with a list of planet_bond_albedo and planet_circulation_efficiency. It creates a file named "WASP43b_JWST_bb_bb_various_Ab_eps.pickle".

*boats_example7*: This example is to compute the bias over two instrument passbands one with one without wavelength bins, using _Blackbody_ stellar_models_grid, _Blackbody_ planet_models_grid with a list of planet_bond_albedo and planet_circulation_efficiency. It creates a file named "WASP43b_NIRISS_MIRInobins_bb_bb_various_Ab_eps.pickle".

*boats_example8*: This example is to compute the bias over four instrument passbands without wavelength bins, using _Blackbody_ stellar_models_grid, _Blackbody_ planet_models_grid with a list of planet_bond_albedo and planet_circulation_efficiency. It creates a file named "WASP43b_JWST_bb_bb_various_Tday_Tnight.pickle".


=== BOATS output files
When running boats.boats_calculate_transit or boats.boats_calculate_eclipse, the results can be stored in files with the extension _.txt_ and/or _.pickle_.
The _txt_ files are easy to read. The first row reports a string that defines a configuration (e.g., "albedo0.0_efficiency0.0_obs_duration_2.5T_14", "albedo0.23_Tday1600.0K_Tnight850.0K_obs_duration_2.5T_14"). The second row contains the column headers:

- case of transit: "passband", "transit_depth (ppm)", "transit_depth_sigma", "transit_depth_bias", "self_blend_bias", "phase_blend_bias";
- case of eclipse: "passband", "eclipse_depth_measured (ppm)", "eclipse_depth_sigma", "eclipse_depth_average_in", "eclipse_depth_peak_in".

The following lines report the passband names (including wavelength bin limits) and the corresponding results.

If more configurations are calculated, the same structure is repeated more times in the same _txt_ file. 

The _pickle_ format is specifically designed to save objects created with _python_ (https://pythontips.com/2013/08/02/what-is-pickle-in-python/[more info]).
The objects created with boats.boats_calculate_transit or boats.boats_calculate_eclipse are _python_ https://docs.python.org/3/tutorial/datastructures.html#dictionaries[dictionaries]. The _pickle_ files retain more information than the corresponding _txt_ files.

Let's open the _pickle_ files that have been created with the examples:

[source, bash]
```
>>> import pickle
>>> file1 = pickle.load(open('WASP43b_NIRISS_SOSS_pho1213_bb_Td1600_Tn850_A0e23.pickle','rb'),encoding='latin1')
>>> file2 = pickle.load(open('WASP43b_NIRISS_NIRSpec_bb_bb_Td1600_Tn850_A0e23.pickle','rb'),encoding='latin1')
>>> file3 = pickle.load(open('WASP43b_NIRISS_SOSS_bb_ace_Td1600_Tn850_A0e23.pickle','rb'),encoding='latin1')
>>> file4 = pickle.load(open('WASP43b_MIRI_LRS_jy_ace_Td1600_Tn850_A0e23.pickle','rb'),encoding='latin1')
>>> file5 = pickle.load(open('WASP43b_MIRI_LRS_jy_ace_Td1600_Tn850_A0e23_eclipse.pickle','rb'),encoding='latin1')
>>> file6 = pickle.load(open('WASP43b_JWST_bb_bb_various_Ab_eps.pickle','rb'),encoding='latin1')
>>> file7 = pickle.load(open('WASP43b_NIRISS_MIRInobins_bb_bb_various_Ab_eps.pickle','rb'),encoding='latin1')
>>> file8 = pickle.load(open('WASP43b_JWST_bb_bb_various_Tday_Tnight.pickle','rb'),encoding='latin1')
```
Each file contains a dictionary, therefore we print the keys:
[source, bash]
```
>>> file1.keys()
dict_keys(['input_info', 'results'])
```
The "input_info" contains all the keywords from the configuration file (in this case "boats_example1.txt"), including those not given which are then set to the default values. This offers a way to check all the calculation options that led to the results.

The results are split into one or more configurations associated with the exoplanet atmosphere:
[source, bash]
```
>>> file1['results'].keys()
dict_keys(['albedo0.23_Tday1600.0K_Tnight850.0K'])
>>> file3['results'].keys()
dict_keys(['albedo0.23'])
>>> file6['results'].keys()
dict_keys(['albedo0.0_efficiency0.0', 'albedo0.0_efficiency1.0', 'albedo0.0_efficiency0.19', 'albedo0.23_efficiency0.0', 'albedo0.23_efficiency1.0', 'albedo0.23_efficiency0.19'])
```
Note that the atmospheric configuration can be defined by:

- albedo, dayside and nightside temperatures;
- only albedo, if the dayside and nightside spectra are provided by the user;
- albedo and circulation efficiency.

The next level of the dictionary contains the passband labels:
[source, bash]
```
>>> file1['results']['albedo0.23_Tday1600.0K_Tnight850.0K'].keys()
dict_keys(['JWST_NIRISS_ord1', 'JWST_NIRISS_ord1_6000.0_7000.0', 'JWST_NIRISS_ord1_7000.0_7500.0', 'JWST_NIRISS_ord1_7500.0_8000.0', 'JWST_NIRISS_ord1_8000.0_8300.0', 'JWST_NIRISS_ord1_8300.0_8600.0', 'JWST_NIRISS_ord1_8600.0_8900.0', 'JWST_NIRISS_ord1_8900.0_9200.0', 'JWST_NIRISS_ord1_9200.0_9400.0', 'JWST_NIRISS_ord1_9400.0_9600.0', 'JWST_NIRISS_ord1_9600.0_9800.0', 'JWST_NIRISS_ord1_9800.0_10000.0', 'JWST_NIRISS_ord1_10000.0_10200.0', 'JWST_NIRISS_ord1_10200.0_10400.0', 'JWST_NIRISS_ord1_10400.0_10600.0', 'JWST_NIRISS_ord1_10600.0_10800.0', 'JWST_NIRISS_ord1_10800.0_11000.0', 'JWST_NIRISS_ord1_11000.0_11200.0', 'JWST_NIRISS_ord1_11200.0_11400.0', 'JWST_NIRISS_ord1_11400.0_11600.0', 'JWST_NIRISS_ord1_11600.0_11800.0', 'JWST_NIRISS_ord1_11800.0_12000.0', 'JWST_NIRISS_ord1_12000.0_12200.0', 'JWST_NIRISS_ord1_12200.0_12400.0', 'JWST_NIRISS_ord1_12400.0_12600.0', 'JWST_NIRISS_ord1_12600.0_12800.0', 'JWST_NIRISS_ord1_12800.0_13000.0', 'JWST_NIRISS_ord1_13000.0_13200.0', 'JWST_NIRISS_ord1_13200.0_13400.0', 'JWST_NIRISS_ord1_13400.0_13600.0', 'JWST_NIRISS_ord1_13600.0_13800.0', 'JWST_NIRISS_ord1_13800.0_14000.0', 'JWST_NIRISS_ord1_14000.0_14200.0', 'JWST_NIRISS_ord1_14200.0_14400.0', 'JWST_NIRISS_ord1_14400.0_14600.0', 'JWST_NIRISS_ord1_14600.0_14800.0', 'JWST_NIRISS_ord1_14800.0_15000.0', 'JWST_NIRISS_ord1_15000.0_15200.0', 'JWST_NIRISS_ord1_15200.0_15400.0', 'JWST_NIRISS_ord1_15400.0_15600.0', 'JWST_NIRISS_ord1_15600.0_15800.0', 'JWST_NIRISS_ord1_15800.0_16000.0', 'JWST_NIRISS_ord1_16000.0_16200.0', 'JWST_NIRISS_ord1_16200.0_16400.0', 'JWST_NIRISS_ord1_16400.0_16600.0', 'JWST_NIRISS_ord1_16600.0_16800.0', 'JWST_NIRISS_ord1_16800.0_17000.0', 'JWST_NIRISS_ord1_17000.0_17200.0', 'JWST_NIRISS_ord1_17200.0_17400.0', 'JWST_NIRISS_ord1_17400.0_17600.0', 'JWST_NIRISS_ord1_17600.0_17800.0', 'JWST_NIRISS_ord1_17800.0_18000.0', 'JWST_NIRISS_ord1_18000.0_18200.0', 'JWST_NIRISS_ord1_18200.0_18400.0', 'JWST_NIRISS_ord1_18400.0_18600.0', 'JWST_NIRISS_ord1_18600.0_18800.0', 'JWST_NIRISS_ord1_18800.0_19000.0', 'JWST_NIRISS_ord1_19000.0_19200.0', 'JWST_NIRISS_ord1_19200.0_19400.0', 'JWST_NIRISS_ord1_19400.0_19600.0', 'JWST_NIRISS_ord1_19600.0_19800.0', 'JWST_NIRISS_ord1_19800.0_20100.0', 'JWST_NIRISS_ord1_20100.0_20400.0', 'JWST_NIRISS_ord1_20400.0_20700.0', 'JWST_NIRISS_ord1_20700.0_21000.0', 'JWST_NIRISS_ord1_21000.0_21300.0', 'JWST_NIRISS_ord1_21300.0_21600.0', 'JWST_NIRISS_ord1_21600.0_21900.0', 'JWST_NIRISS_ord1_21900.0_22200.0', 'JWST_NIRISS_ord1_22200.0_22500.0', 'JWST_NIRISS_ord1_22500.0_22800.0', 'JWST_NIRISS_ord1_22800.0_23100.0', 'JWST_NIRISS_ord1_23100.0_23400.0', 'JWST_NIRISS_ord1_23400.0_23800.0', 'JWST_NIRISS_ord1_23800.0_24200.0', 'JWST_NIRISS_ord1_24200.0_24600.0', 'JWST_NIRISS_ord1_24600.0_25000.0', 'JWST_NIRISS_ord1_25000.0_25500.0', 'JWST_NIRISS_ord1_25500.0_26000.0', 'JWST_NIRISS_ord1_26000.0_26500.0', 'JWST_NIRISS_ord1_26500.0_27000.0', 'JWST_NIRISS_ord1_27000.0_27500.0', 'JWST_NIRISS_ord1_27500.0_28000.0'])
```
The passband keys include:

- 'JWST_NIRISS_ord1', i.e., the requested passband;
- 'JWST_NIRISS_ord1_lambda1_lambda2', where lambda1 and lambda2 are the lower and upper limits of the requested wavelength bins (in Angstrom).

The next level may contain one or more keys associated with the requested observing duration(s):
[source, bash]
```
>>> file1['results']['albedo0.23_Tday1600.0K_Tnight850.0K']['JWST_NIRISS_ord1'].keys()
dict_keys(['obs_duration_2.5T_14'])
```
The next level contains the final keys that give access to the calculated quantities, notably the bias terms and predicted error bars.
[source, bash]
```
>>> file1['results']['albedo0.23_Tday1600.0K_Tnight850.0K']['JWST_NIRISS_ord1']['obs_duration_2.5T_14'].keys()
dict_keys(['transit_depth_bias', 'phase_blend_bias', 'self_blend_bias', 'transit_depth', 'transit_duration_T14', 'observing_duration', 'planet_day_temperature', 'planet_night_temperature', 'star_flux', 'planet_day_flux', 'planet_night_flux', 'planet_flux_oot', 'planet_flux_in', 'transit_depth_sigma'])
>>> file1['results']['albedo0.23_Tday1600.0K_Tnight850.0K']['JWST_NIRISS_ord1']['obs_duration_2.5T_14']['transit_depth_bias']
<Quantity 14.90930371 ppm>
>>> file1['results']['albedo0.23_Tday1600.0K_Tnight850.0K']['JWST_NIRISS_ord1']['obs_duration_2.5T_14']['phase_blend_bias']
<Quantity 15.86343971 ppm>
>>> file1['results']['albedo0.23_Tday1600.0K_Tnight850.0K']['JWST_NIRISS_ord1']['obs_duration_2.5T_14']['self_blend_bias']
<Quantity -0.954136 ppm>
>>> file1['results']['albedo0.23_Tday1600.0K_Tnight850.0K']['JWST_NIRISS_ord1']['obs_duration_2.5T_14']['transit_depth_sigma']
<Quantity 4.93803074 ppm>
```
Note that the transit depth bias is the sum of phase-blend and self-blend biases. All the other output quantities can be used to verify Equations X-Y of the https://arxiv.org/pdf/[paper].

CONTINUE FROM HERE

[[intensity_profiles]]
.Left panel: Rescaled intensity profile (blue dots) and fitted profile with claret-4 limb-darkening coefficients (red line). Right panel: Original intensity profile (black dots) and rescaled intensity profile (blue dots). Note the slightly different mu values between the two profiles. Read the https://arxiv.org/pdf/1908.09599.pdf[reference paper] for information about the underlying procedure.
image::https://github.com/ucl-exoplanets/ExoTETHyS/blob/v2-beta/user_manuals/figures/merge_rescaled_vs_claret4_et_original_intensities.png[width=100%]


NOTE: These profiles can be used as input for generating the transit light-curves with the TRIP subpackage (link:TRIP_manual.adoc[TRIP manual]).

NOTE: If you are interested to the intensity profiles rather than limb-darkening coefficients, you should choose the _grid_ calculation_type and _complete_ user_output. The intensity profiles can be provided only for the models in the database; these are not interpolated to obtain the intensity profiles of stars with different sets of parameter values.

=== Other SAIL functions
The list of functions available within SAIL subpackage can be obtained by typing the standard python command `dir(sail)`. All functions are documented with docstrings.
For example:
[source, bash]
```
>>> print(sail.get_intensities_from_ldcs.__doc__)

    This function computes the model intensities given the limb-darkening coefficients
    
    :param np.array mu: 1D array with mu values
    :param np.array coefficients: 1D array with the limb-darkening coefficients
    :param str law: name of the limb-darkening law
    :return: the intensities at the given mu values
    :rtype: np.array
```
The function "sail.get_intensities_from_ldcs" has been added to enable quick visualization of the intensity profile from the calculated LDCs, but it is not used during the LDCs calculation.

The function "sail.get_grid_parameters" can be used to know the range and sampling of stellar parameter space covered by the grids in the database, and it is also used during the LDCs calculation.

In the future we might add/hightlight here other functions, depending on the users feedback.

== Database files
Some stellar model files will be needed during a SAIL run. The necessary files will be downloaded automatically during the run, unless these files are already found in a directory inside `PATH_HOME/.exotethys`. Such files are a collateral output of ExoTETHyS.SAIL, as they are only needed to perform other calculations. +
However, the database files contain valuable information even outside the ExoTETHyS framework. Therefore, I explain how to read the database files.

The manage_database subpackage (link[manual]) can be used to find out the path and names of the database files:
[source, bash]
```
>>> from exotethys import manage_database as mdb
>>> path, filenames = mdb.ls_database(grid='Phoenix_2012_13')
>>> path
'/Users/pepe/.exotethys/Phoenix_2012_13'
>>> filenames
['teff03000_logg5.50_MH0.0.pickle', 'teff05700_logg4.5_MH0.0.pickle', 'teff05800_logg4.5_MH0.0.pickle', 'teff06100_logg4.5_MH0.0.pickle']
```
Note that the database files have _pickle_ format and contain _python_ dictionaries. Let's now read one of these files:
[source, bash]
```
>>> import os, pickle
>>> chosen_file_path = os.path.join(path, 'teff05800_logg4.5_MH0.0.pickle')
>>> content = pickle.load(open(chosen_file_path,'rb'),encoding='latin1')
>>> content.keys()
dict_keys(['mu', 'wavelengths', 'star_params', 'intensities', 'fluxes'])
```
- The "star_params" branch contains a numpy array with the stellar parameters. +
- The "wavelengths" branch contains a https://docs.astropy.org/en/stable/units/[quantity array] with the model wavelengths. +
- The "mu" branch contains a numpy array of positions on the stellar disk. +
- The "intensities" branch contains a 2D numpy array with the model intensities at the tabulated mu and wavelengths. +
- The "fluxes" branch contains the disk-integrated flux at the stellar surface.


